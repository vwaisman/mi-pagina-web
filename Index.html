<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Ley Micaela (Demo)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7fb; color: #111; }
    header { padding: 20px 18px; background: #fff; border-bottom: 1px solid #e7e7ef; }
    main { max-width: 980px; margin: 18px auto; padding: 0 18px 28px; }
    .card { background: #fff; border: 1px solid #e7e7ef; border-radius: 14px; padding: 16px; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .row { display: grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 860px){ .row { grid-template-columns: 340px 1fr; } }
    label { font-size: 14px; font-weight: 600; display: block; margin-bottom: 8px; }
    select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #d9d9e6; background: #fff; font-size: 15px; }
    .kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .kpi .mini { border: 1px solid #eee; border-radius: 12px; padding: 10px 12px; background: #fafbff; }
    .mini .v { font-size: 22px; font-weight: 800; margin-top: 4px; }
    .muted { color: #444; font-size: 14px; line-height: 1.35; }
    canvas { max-height: 420px; }
    footer { max-width: 980px; margin: 0 auto; padding: 0 18px 24px; color: #555; font-size: 12px; }
    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; border:1px solid #e7e7ef; background:#fff; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <div style="max-width:980px;margin:0 auto;">
      <h1 style="margin:0 0 6px;font-size:20px;">Dashboard interactivo — Ley Micaela (datos simulados)</h1>
      <div class="muted">Explorá participación y aprobación por área. Usá el filtro por año para actualizar el gráfico.</div>
    </div>
  </header>

  <main class="row">
    <section class="card">
      <label for="yearSelect">Filtro por año</label>
      <select id="yearSelect" aria-label="Seleccionar año"></select>

      <div class="kpi" aria-label="Indicadores">
        <div class="mini">
          <div class="muted">Personas capacitadas</div>
          <div class="v" id="kpiCap">—</div>
        </div>
        <div class="mini">
          <div class="muted">Tasa de aprobación</div>
          <div class="v" id="kpiAprob">—</div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid #eee;margin:14px 0;">

      <div class="muted" id="desc">
        Seleccioná un año para ver cuántas personas fueron capacitadas y cuántas aprobaron, agrupadas por área.
      </div>

      <div style="margin-top:10px;">
        <span class="pill">Demo</span>
        <span class="pill">Barras</span>
        <span class="pill">Filtro por año</span>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px;">Aprobadas por área</h2>
      <canvas id="barChart" aria-label="Gráfico de barras"></canvas>
    </section>
  </main>

  <footer>
    Nota: estos valores son <strong>simulados</strong> para fines educativos. En un caso real, se reemplazan por datos de planillas (CSV/Excel) o APIs de fuentes abiertas.
  </footer>

  <script>
    // Datos simulados (podés reemplazar por datos reales luego)
    const dataByYear = {
      2023: [
        { area: "Educación", capacitadas: 420, aprobadas: 380 },
        { area: "Salud", capacitadas: 260, aprobadas: 230 },
        { area: "Administración", capacitadas: 310, aprobadas: 275 },
        { area: "Territorio", capacitadas: 190, aprobadas: 160 }
      ],
      2024: [
        { area: "Educación", capacitadas: 520, aprobadas: 480 },
        { area: "Salud", capacitadas: 290, aprobadas: 255 },
        { area: "Administración", capacitadas: 360, aprobadas: 330 },
        { area: "Territorio", capacitadas: 240, aprobadas: 210 }
      ],
      2025: [
        { area: "Educación", capacitadas: 610, aprobadas: 565 },
        { area: "Salud", capacitadas: 340, aprobadas: 305 },
        { area: "Administración", capacitadas: 410, aprobadas: 372 },
        { area: "Territorio", capacitadas: 280, aprobadas: 248 }
      ]
    };

    const yearSelect = document.getElementById("yearSelect");
    const kpiCap = document.getElementById("kpiCap");
    const kpiAprob = document.getElementById("kpiAprob");
    const desc = document.getElementById("desc");

    // Cargar opciones de años (ordenadas)
    const years = Object.keys(dataByYear).map(Number).sort((a,b)=>a-b);
    years.forEach(y => {
      const opt = document.createElement("option");
      opt.value = y;
      opt.textContent = y;
      yearSelect.appendChild(opt);
    });
    yearSelect.value = years[years.length - 1];

    // Chart.js
    const ctx = document.getElementById("barChart");
    const chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: [],
        datasets: [
          {
            label: "Aprobadas",
            data: []
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
          tooltip: { enabled: true }
        },
        scales: {
          y: { beginAtZero: true, ticks: { precision: 0 } }
        }
      }
    });

    function formatPct(x){
      return (x * 100).toFixed(1).replace(".", ",") + "%";
    }

    function updateDashboard(year){
      const rows = dataByYear[year];
      const labels = rows.map(r => r.area);
      const aprobadas = rows.map(r => r.aprobadas);

      // KPIs
      const totalCap = rows.reduce((s,r)=> s + r.capacitadas, 0);
      const totalApr = rows.reduce((s,r)=> s + r.aprobadas, 0);
      const tasa = totalCap > 0 ? (totalApr / totalCap) : 0;

      kpiCap.textContent = totalCap.toLocaleString("es-AR");
      kpiAprob.textContent = formatPct(tasa);

      // Texto descriptivo
      desc.textContent =
        `En ${year}, se capacitaron ${totalCap.toLocaleString("es-AR")} personas y aprobaron ` +
        `${totalApr.toLocaleString("es-AR")} (tasa de aprobación: ${formatPct(tasa)}).`;

      // Actualizar gráfico
      chart.data.labels = labels;
      chart.data.datasets[0].data = aprobadas;
      chart.update();
    }

    yearSelect.addEventListener("change", (e) => {
      updateDashboard(Number(e.target.value));
    });

    // Inicial
    updateDashboard(Number(yearSelect.value));
  </script>
</body>
</html>
